# 用户统计-用户注册投资情况查询
## 需求描述
### v1.0
> + 新增每个用户ID对应的[姓名]、[手机号]显示；
> + 新增[回访记录]，包括查看、新增两个操作；（位置建议在表单最左）
> + 回访记录可以多次新增，不能删除、编辑
> + 查看回访记录的提交时间、提交人在后台直接获取新增时间以及操作人姓名
> + 新增 导出excel 功能，导出内容为当前查询内容
### v1.1
> + 用户名称只显示第一个字，其余字段用“*”代替
> + 隐藏用户ID
> + 菜单权限开通给客服
### v1.2
> + 新建菜单展示内容—用户注册查询（此菜单只展示给客服）
> + 表头年化投资额、总资产、存量资产、累计投资收隐藏
> + 菜单展示最近30天数据
> + 导出表内容包括用户名称（姓氏+*）、手机号、渠道来源、注册日期、用户投资次数、账户余额

## 修改逻辑
### 菜单位置
> 业务查询--用户注册查询
### 列表字段
> + 增加显示姓名、手机号、回访记录。
> + 删除显示用户ID。
### 展示逻辑
> + 前三个字段依次展示回访记录、姓名、手机号。
> + 回访记录包括查看、新增两个操作，查看时列表分页展示。
> + 姓名只展示第一个字，其余字段用“*”代替
> + 手机号全显展示
> + 回访记录新增时记录提交时间、提交人和回访记录内容。
> + 页面新增导出excel 按钮，实现导出功能。
### 代码修改
> + 页面根据字段的变化做相应的修改。
> + 姓名与手机号后台已经做过查询，可以直接在页面取到。其中，姓名要做模糊显示。模糊显示的代码逻辑是：根据姓名字符串的长度创建新的、以“*”组成的字符串，新字符串的长度比姓名字符串的长度少1，例如“刘弗陵”对应创建的字符串为“**”。然后将姓名字符串截取第一位（“刘弗陵”为“刘”）后与新字符串拼接。
> + 回收记录的两个操作模仿管理台已有菜单【注册用户管理--用户管理】操作里的两个功能。回访记录里的查看对应【注册用户管理--用户管理】操作里的查看线下，新增对应新增。其中，查看下线会打开新的菜单页面，页面以列表的方式显示，符合需求的展示方式，只需要修改相应的字段即可。新增时打开新的悬浮菜单，也是修改悬浮菜单中的内容即可。
> + 新增回访记录时填写回访记录的文本内容，上传用户id，后台获取当前时间，从cookie 中获取提交人的信息后将这四个字段（用户id，提交时间，提交人，回访记录）放入数据库 中存储。
> + 查询回访记录时从数据库 中取出数据并分页展示。
> + 从其他菜单中拷贝一套导出excel 的代码。
### 数据库相关
> + 新建菜单`用户注册查询`

```
   INSERT INTO `m_menu` (`url`, `parent_id`, `order_num`, `name`, `note`) VALUES ('/bsuserRegister/index.htm', 21, 30, '用户注册查询', NULL);
```
> + 创建回访记录表（bs_return_visit_record），字段有序号(id)、用户编号(user_id)、回访时间(submit_time)、回访人(submitter)、回访内容(content)

```
    CREATE TABLE `bs_return_visit_record` (
          `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '编号',
          `user_id` int(11) NOT NULL COMMENT '用户编号',
          `submit_time` datetime DEFAULT NULL COMMENT '回访时间',
          `submitter` varchar(20) DEFAULT NULL COMMENT '回访人',
          `content` varchar(64) DEFAULT NULL COMMENT '回访内容',
          PRIMARY KEY (`id`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='回访记录表';
```