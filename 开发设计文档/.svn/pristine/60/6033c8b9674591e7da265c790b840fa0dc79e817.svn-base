# 自由站岗户购买
## 需求背景
> 现阶段的产品计划在初始发布阶段即固定了对应的资产方，导致对应资产方不能消化分配的资金时，资金闲置产生不必要的成本，现在只有定期的自由资金计划
## 购买逻辑
### 普通购买(DepUserBalanceBuyServiceImpl.buyFixed)
+ 清除redis 缓存
+ redis 加锁
+ 余额购买前置校验
+ 非自主放款标识不允许购买,**增加FREE**
+ 事务开始
+ 固定期限产品购买子账户对开户
+ 新增订单表
+ 新增订单流水表
+ 新增用户交易明细表
+ 减少用户的JSH(结算户)余额
+ 减少系统的USER(用户余额户)余额
+ 增加系统的AUTH_YUN || AUTH_ZSD余额
+ 修改用户信息表
+ 修改产品表中的累计人次和累计金额
+ 判读用户是否为首次购买,**增加AUTH_FREE**
+ 用户余额购买记账流水表
+ 判断是否支持红包
+ 事务结束
+ 奖励金处理
+ 满额发自动红包
+ 请求恒丰自有子账户转账至抵用金子账户
+ 加息券
+ 短信模板、微信模板通知
+ redis 释放锁
### 超级理财人购买(DepUserBalanceBuyServiceImpl.buyFixed4Super)
+ redis 加锁
+ 开启事务
+ 查询VIP站岗户
+ 站岗户生成
+ 补差户生成
+ 子账户插入
+ 新增订单表
+ 新增订单流水表
+ 新增用户交易明细表
+ 减少用户的JSH(结算户)余额
+ 站岗户金额增加
+ 减少系统的USER(用户余额户)余额
+ 增加系统余额
+ 修改用户信息表
+ 修改产品表中的累计人次和累计金额
+ 判断用户是否为首次购买，**增加AUTH_FREE**
+ 用户余额购买记账流水表
+ 系统用户购买记账流水表
+ 结束事务
+ redis 释放锁
## 插入
```
    -- 表数据新增
    INSERT INTO `bs_sys_config` VALUES ('FREE_SUPER_FINANCE_USER_ID', '35893', '自由资金VIP理财人用户编号', '自由资金VIP理财人用户编号');

    -- 需要在新增产品修改修改id
    INSERT INTO `bs_sys_config` VALUES ('FREE_SUPER_PRODUCT_ID ', '1884', '自由资金VIP理财VI专享产品编号, '自由资金VIP理财VI专享产品编号');
```